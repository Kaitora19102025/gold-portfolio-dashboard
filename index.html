<!DOCTYPE html>
<html>
<head>
<title>Gold Portfolio Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
font-family:Arial;
background:#f4f6f9;
padding:20px;
}

h1{color:#b8860b;}

.card{
background:white;
padding:20px;
margin-bottom:20px;
border-radius:12px;
box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

input,select{
padding:6px;
border-radius:6px;
border:1px solid #ccc;
margin:4px;
}

button{
padding:6px 12px;
border:none;
border-radius:6px;
background:#b8860b;
color:white;
cursor:pointer;
}

button:hover{
background:#a47508;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border-bottom:1px solid #eee;
text-align:right;
}

th:first-child,td:first-child{text-align:center;}
th:nth-child(3),td:nth-child(3){text-align:left;}

.green{color:#0a8f3d;font-weight:bold;}
.red{color:#c0392b;font-weight:bold;}
.gray{color:gray;}

.chart-container{
max-width:450px;
height:320px;
margin:auto;
}

.lock{
color:gray;
}

</style>
</head>
<body>

<h1>ðŸª™ Gold Portfolio Dashboard</h1>

<!-- INPUT DATA -->
<div class="card">

<h3>Tambah Transaksi</h3>

Gram:
<input type="number" id="gram">

Type:
<input type="text" id="type">

Harga Beli:
<input type="number" id="beli">

Status:
<select id="status">
<option value="READY">READY</option>
<option value="PO">PO</option>
<option value="SOLD">SOLD</option>
</select>

<button onclick="addData()">Tambah</button>

</div>


<!-- GOLD PRICE -->
<div class="card">

Harga emas per gram:

<input type="number" id="currentPrice" value="1600000">

<button onclick="calculate()">Update</button>

</div>


<!-- SUMMARY -->
<div class="card">

<p>Total Modal Aktif: <span id="modal"></span></p>

<p>Total Realized Profit: <span id="profit"></span></p>

<p>Total Gram Aktif: <span id="gramTotal"></span></p>

<p>Nilai Portfolio: <span id="portfolio"></span></p>

<p>Unrealized P/L: <span id="unreal"></span></p>

</div>


<!-- CHART -->
<div class="card">

<h3>Status Distribution</h3>

<div class="chart-container">
<canvas id="chart"></canvas>
</div>

</div>


<!-- TABLE -->
<div class="card">

<h3>Detail Transaksi</h3>

<table>

<thead>

<tr>
<th>No</th>
<th>Gram</th>
<th>Type</th>
<th>Beli</th>
<th>Jual</th>
<th>Status</th>
<th>Profit</th>
<th>Action</th>
</tr>

</thead>

<tbody id="tbody"></tbody>

</table>

</div>


<script>

// ======================
// DATA AWAL (TERKUNCI)
// ======================

const defaultData=[

{gram:5,type:"LM",beli:13500000,jual:15700000,status:"SOLD"},
{gram:8,type:"LM IMLEK 2026",beli:23950800,jual:26500000,status:"SOLD"},
{gram:2,type:"LM",beli:5676000,jual:0,status:"PO"},
{gram:3,type:"LM",beli:9744000,jual:0,status:"PO"},
{gram:0.5,type:"LM WEDDING COUPLE",beli:1633500,jual:0,status:"READY"},
{gram:0.5,type:"LM BABY BOY",beli:1633500,jual:0,status:"READY"},
{gram:0.5,type:"LM BABY GIRL",beli:1633500,jual:0,status:"READY"},
{gram:0.5,type:"LM WEDDING COUPLE",beli:1606500,jual:0,status:"READY"},
{gram:0.5,type:"LM BABY BOY",beli:1606500,jual:0,status:"READY"},
{gram:8,type:"LM IMLEK 2026",beli:24447300,jual:0,status:"READY"}

];


// ======================
// STORAGE
// ======================

let userData =
JSON.parse(localStorage.getItem("userData")) || [];

let defaultOverride =
JSON.parse(localStorage.getItem("defaultOverride")) || [];

let chart;


// ======================
// SAVE
// ======================

function save(){

localStorage.setItem(
"userData",
JSON.stringify(userData)
);

localStorage.setItem(
"defaultOverride",
JSON.stringify(defaultOverride)
);

}


// ======================
// GET DATA
// ======================

function getData(){

let merged=[...defaultData];

defaultOverride.forEach((o,i)=>{

merged[i]={...merged[i],...o};

});

return [...merged,...userData];

}


// ======================
// ADD DATA
// ======================

function addData(){

let gram =
parseFloat(document.getElementById("gram").value);

let type =
document.getElementById("type").value;

let beli =
parseFloat(document.getElementById("beli").value);

let status =
document.getElementById("status").value;

let price =
parseFloat(document.getElementById("currentPrice").value);

let jual =
status=="SOLD"? gram*price : 0;

userData.push({
gram,type,beli,jual,status
});

save();

render();

calculate();

}


// ======================
// UPDATE STATUS
// ======================

function updateStatus(index,value){

let price =
parseFloat(document.getElementById("currentPrice").value);

let d =
getData()[index];

if(index<defaultData.length){

defaultOverride[index] =
defaultOverride[index] || {};

defaultOverride[index].status=value;

if(value=="SOLD" &&
!defaultOverride[index].jual){

defaultOverride[index].jual =
d.gram * price;

}

}else{

let i=index-defaultData.length;

userData[i].status=value;

if(value=="SOLD" &&
!userData[i].jual){

userData[i].jual =
d.gram * price;

}

}

save();

render();

calculate();

}


// ======================
// UPDATE JUAL
// ======================

function updateJual(index,value){

value=parseFloat(value)||0;

if(index<defaultData.length){

defaultOverride[index] =
defaultOverride[index] || {};

defaultOverride[index].jual=value;

if(value>0){
defaultOverride[index].status="SOLD";
}

}else{

let i=index-defaultData.length;

userData[i].jual=value;

if(value>0){
userData[i].status="SOLD";
}

}

save();

render();

calculate();

}


// ======================
// DELETE DATA BARU
// ======================

function deleteData(index){

userData.splice(index,1);

save();

render();

calculate();

}


// ======================
// RENDER TABLE
// ======================

function render(){

let data=getData();

let tbody =
document.getElementById("tbody");

tbody.innerHTML="";

data.forEach((d,i)=>{

let profit =
d.status=="SOLD" ?
d.jual-d.beli : null;

let cls =
profit>0 ? "green" :
profit<0 ? "red" : "gray";

tbody.innerHTML += `

<tr>

<td>${i+1}</td>

<td>${d.gram}</td>

<td>${d.type}</td>

<td>Rp ${d.beli.toLocaleString("id-ID")}</td>

<td>
<input type="number"
value="${d.jual||""}"
onchange="updateJual(${i},this.value)">
</td>

<td>
<select onchange="updateStatus(${i},this.value)">

<option ${d.status=="READY"?"selected":""}>
READY
</option>

<option ${d.status=="PO"?"selected":""}>
PO
</option>

<option ${d.status=="SOLD"?"selected":""}>
SOLD
</option>

</select>
</td>

<td class="${cls}">
${profit!=null ?
"Rp "+profit.toLocaleString("id-ID")
:"-"}
</td>

<td>
${i<defaultData.length
? '<span class="lock">ðŸ”’</span>'
: `<button onclick="deleteData(${i-defaultData.length})">
Hapus</button>`}
</td>

</tr>

`;

});

}


// ======================
// CALCULATE (FIXED)
// ======================

function calculate(){

let price =
parseFloat(document.getElementById("currentPrice").value);

let data =
getData();

let totalModalAktif=0;
let totalRealizedProfit=0;
let totalGramAktif=0;
let nilaiPortfolio=0;

let statusCount={
READY:0,
PO:0,
SOLD:0
};

data.forEach(d=>{

statusCount[d.status]++;

if(d.status=="SOLD"){

totalRealizedProfit +=
(d.jual||0)-d.beli;

}else{

totalModalAktif += d.beli;

totalGramAktif += d.gram;

}

});

nilaiPortfolio =
totalGramAktif * price;

let unrealized =
nilaiPortfolio - totalModalAktif;


// UPDATE UI

document.getElementById("modal").innerHTML =
"Rp " + totalModalAktif.toLocaleString("id-ID");

document.getElementById("profit").innerHTML =
"Rp " + totalRealizedProfit.toLocaleString("id-ID");

document.getElementById("gramTotal").innerHTML =
totalGramAktif + " gram";

document.getElementById("portfolio").innerHTML =
"Rp " + nilaiPortfolio.toLocaleString("id-ID");

document.getElementById("unreal").innerHTML =
`<span class="${unrealized>=0?'green':'red'}">
Rp ${unrealized.toLocaleString("id-ID")}
</span>`;


// CHART

if(chart) chart.destroy();

chart=new Chart(
document.getElementById("chart"),
{
type:"doughnut",
data:{
labels:Object.keys(statusCount),
datasets:[{
data:Object.values(statusCount),
backgroundColor:[
"#2ecc71",
"#f39c12",
"#3498db"
]
}]
},
options:{
responsive:true,
maintainAspectRatio:false
}
});

}


// INIT

render();
calculate();

</script>

</body>
</html>



