<!DOCTYPE html>
<html>
<head>
    <title>Gold Portfolio Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; background:#f4f4f4; padding:20px; }
        .card { background:white; padding:20px; margin:10px 0; border-radius:10px; }
        h1 { color:#b8860b; }
        table { width:100%; border-collapse: collapse; margin-top:10px; }
        th, td { padding:8px; border-bottom:1px solid #ddd; text-align:right; }
        th { background:#fafafa; }
        td:first-child, th:first-child { text-align:center; }
        .green { color:green; font-weight:bold; }
        .red { color:red; font-weight:bold; }
    </style>
</head>
<body>

<h1>ðŸª™ Gold Portfolio Dashboard</h1>

<div class="card">
    <label>Harga emas saat ini (per gram): </label>
    <input type="number" id="currentPrice" value="1600000">
    <button onclick="calculate()">Update</button>
</div>

<div class="card">
    <h3>Summary</h3>
    <p>Total Modal Aktif: <span id="modal"></span></p>
    <p>Total Realized Profit: <span id="profit"></span></p>
    <p>Total Gram Aktif: <span id="gram"></span></p>
    <p>Average Buy / Gram: <span id="avg"></span></p>
    <p>Nilai Portofolio Saat Ini: <span id="portfolio"></span></p>
    <p>Unrealized P/L: <span id="unreal"></span></p>
</div>

<div class="card">
    <h3>Komposisi Status</h3>
    <canvas id="statusChart"></canvas>
</div>

<div class="card">
    <h3>Detail Transaksi</h3>
    <table id="dataTable">
        <thead>
            <tr>
                <th>No</th>
                <th>Gram</th>
                <th>Type</th>
                <th>Beli</th>
                <th>Jual</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>

let goldData = [];

fetch('data.json')
.then(response => response.json())
.then(data => {
    goldData = data;
    renderTable();
    calculate();
});

function renderTable(){
    const tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    goldData.forEach(item => {
        tbody.innerHTML += `
        <tr>
            <td>${item.no}</td>
            <td>${item.gram}</td>
            <td style="text-align:left">${item.type}</td>
            <td>Rp ${item.beli.toLocaleString("id-ID")}</td>
            <td>${item.jual ? "Rp "+item.jual.toLocaleString("id-ID") : "-"}</td>
            <td>${item.status}</td>
        </tr>
        `;
    });
}

function calculate(){

    let currentPrice = parseFloat(document.getElementById("currentPrice").value);

    let modalAktif = 0;
    let realizedProfit = 0;
    let gramAktif = 0;
    let portfolioValue = 0;

    let statusCount = { SOLD:0, READY:0, PO:0 };

    goldData.forEach(item => {

        statusCount[item.status]++;

        if(item.status !== "SOLD"){
            modalAktif += item.beli;
            gramAktif += item.gram;
            portfolioValue += item.gram * currentPrice;
        }

        if(item.status === "SOLD"){
            realizedProfit += (item.jual - item.beli);
        }
    });

    let unrealized = portfolioValue - modalAktif;
    let avgBuy = gramAktif ? modalAktif / gramAktif : 0;

    document.getElementById("modal").innerHTML =
        "Rp " + modalAktif.toLocaleString("id-ID");

    document.getElementById("profit").innerHTML =
        "Rp " + realizedProfit.toLocaleString("id-ID");

    document.getElementById("gram").innerHTML =
        gramAktif + " gram";

    document.getElementById("avg").innerHTML =
        "Rp " + Math.round(avgBuy).toLocaleString("id-ID");

    document.getElementById("portfolio").innerHTML =
        "Rp " + portfolioValue.toLocaleString("id-ID");

    document.getElementById("unreal").innerHTML =
        `<span class="${unrealized >= 0 ? 'green':'red'}">
        Rp ${unrealized.toLocaleString("id-ID")}
        </span>`;

    new Chart(document.getElementById("statusChart"), {
        type: 'pie',
        data: {
            labels: Object.keys(statusCount),
            datasets: [{
                data: Object.values(statusCount)
            }]
        }
    });

}

</script>

</body>
</html>

